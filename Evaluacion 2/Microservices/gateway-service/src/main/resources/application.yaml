server:
  port: 8080

logging:
  level:
    org.springframework.security: DEBUG
    org.springframework.cloud.gateway: DEBUG

spring:
  application:
    name: gateway-service
  config:
    import: "optional:configserver:${URL_CONFIG:http://localhost:8081}"
  main:
    web-application-type: reactive
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_URL:http://localhost:8090}/realms/tingeso

eureka:
  client:
    fetch-registry: true
    register-with-eureka: true
    service-url:
      defaultZone: http://${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}/eureka/
  instance:
    prefer-ip-address: true

spring.cloud.gateway:
  discovery:
    locator:
      enabled: true
      lower-case-service-id: true
  # NOTA: TokenRelay se aplica por ruta, no globalmente
  # default-filters:
  #   - TokenRelay

  routes:
    # Ruta de uploads - Acceso PÚBLICO (sin TokenRelay, sin autenticación)
    - id: uploads-route
      uri: lb://inventory-service
      predicates:
        - Path=/uploads/**
      # Sin filtros de autenticación - acceso público para imágenes
    
    # Rutas con autenticación - incluyen TokenRelay
    - id: inventory-service
      uri: lb://inventory-service
      predicates:
        - Path=/inventory-service/**
      filters:
        - StripPrefix=1
        - TokenRelay
    
    - id: clients-service
      uri: lb://clients-service
      predicates:
        - Path=/clients-service/**
      filters:
        - StripPrefix=1
        - TokenRelay
    
    - id: loans-service
      uri: lb://loans-service
      predicates:
        - Path=/loans-service/**
      filters:
        - StripPrefix=1
        - TokenRelay
    
    - id: kardex-service
      uri: lb://kardex-service
      predicates:
        - Path=/kardex-service/**
      filters:
        - StripPrefix=1
        - TokenRelay
    
    - id: rates-service
      uri: lb://rates-service
      predicates:
        - Path=/rates-service/**
      filters:
        - StripPrefix=1
        - TokenRelay
    
    - id: reports-service
      uri: lb://reports-service
      predicates:
        - Path=/reports-service/**
      filters:
        - StripPrefix=1
        - TokenRelay
    
    - id: users-service
      uri: lb://users-service
      predicates:
        - Path=/users-service/**
      filters:
        - StripPrefix=1
        - TokenRelay
